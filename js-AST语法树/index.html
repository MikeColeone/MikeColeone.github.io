<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Keep Team">
    
    <title>
        
        Keep Theme
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Keep Theme","author":"Keep Team","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":false,"preload":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.3"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Keep Theme
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Keep Team</span>
                                
                                    <span class="author-badge">Lv5</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-09-10 02:43:59</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Sat May 24 2025 22:11:31 GMT+0800">2025-05-24 22:11:31</span>
            </span>
        

        

        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <p>AST（抽象语法树，Abstract Syntax Tree）是编程语言中<strong>源代码的一种树状结构表示</strong>，它表达了代码的<strong>语法结构和逻辑结构</strong>，但不包含一些具体的语法细节（如分号、括号等），因此叫“<strong>抽象</strong>”语法树。</p>
<hr>
<h2 id="✅-一、什么是AST（抽象语法树）？"><a href="#✅-一、什么是AST（抽象语法树）？" class="headerlink" title="✅ 一、什么是AST（抽象语法树）？"></a>✅ 一、什么是AST（抽象语法树）？</h2><p>可以理解为：<strong>AST是编程语言将代码转化成机器能理解和处理的“结构化数据”的过程中的一个中间表示。</strong></p>
<p>在编译器或解释器中，源代码会经历如下几个阶段：</p>
<ol>
<li><p><strong>词法分析</strong>：将代码分解成一系列“单词”（token），比如关键字、变量名、符号等。</p>
</li>
<li><p><strong>语法分析</strong>：根据语言的语法规则，把这些词语（token）组织成“语法结构”——也就是AST。</p>
</li>
<li><p><strong>语义分析 &#x2F; 中间代码生成 &#x2F; 代码优化等</strong></p>
</li>
</ol>
<h3 id="🌳-举个例子："><a href="#🌳-举个例子：" class="headerlink" title="🌳 举个例子："></a>🌳 举个例子：</h3><p>代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">2</span> + <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>它的AST（用树状结构简化表示）如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VariableDeclaration</span><br><span class="line"> └─ VariableDeclarator</span><br><span class="line">     ├─ Identifier (x)</span><br><span class="line">     └─ BinaryExpression (+)</span><br><span class="line">         ├─ Literal (2)</span><br><span class="line">         └─ Literal (3)</span><br></pre></td></tr></table></figure>

<p>你可以看到，AST不会关心是否写了分号、是否换行，而是直接抓住了这段代码的<strong>本质结构：定义了一个变量 x，其值是 2 + 3</strong>。</p>
<hr>
<h2 id="✅-二、AST-的结构特点"><a href="#✅-二、AST-的结构特点" class="headerlink" title="✅ 二、AST 的结构特点"></a>✅ 二、AST 的结构特点</h2><ul>
<li><p><strong>节点（Node）</strong>：每个节点表示代码中的一种结构，比如函数、变量、表达式等。</p>
</li>
<li><p><strong>类型（type）</strong>：每个节点有一个<code>type</code>字段，比如是<code>BinaryExpression</code>、<code>Identifier</code>、<code>FunctionDeclaration</code>。</p>
</li>
<li><p><strong>子节点（children）</strong>：节点可能有子节点，比如一个函数声明有参数列表、函数体等。</p>
</li>
</ul>
<hr>
<h2 id="✅-三、AST-的实际应用场景"><a href="#✅-三、AST-的实际应用场景" class="headerlink" title="✅ 三、AST 的实际应用场景"></a>✅ 三、AST 的实际应用场景</h2><p>AST 不只是编译器的玩具，它在<strong>很多开发工具和框架中都有广泛的应用</strong>：</p>
<h3 id="1-✅-代码分析工具（如-ESLint）"><a href="#1-✅-代码分析工具（如-ESLint）" class="headerlink" title="1. ✅ 代码分析工具（如 ESLint）"></a>1. ✅ 代码分析工具（如 ESLint）</h3><ul>
<li><p><strong>Lint 工具</strong>通过分析 AST 来检查代码是否符合规范。</p>
</li>
<li><p>例：检查是否使用了未定义的变量、是否使用了不推荐的语法。</p>
</li>
</ul>
<h3 id="2-✅-代码格式化工具（如-Prettier）"><a href="#2-✅-代码格式化工具（如-Prettier）" class="headerlink" title="2. ✅ 代码格式化工具（如 Prettier）"></a>2. ✅ 代码格式化工具（如 Prettier）</h3><ul>
<li><p>自动排版代码的结构和风格，但不改变含义。</p>
</li>
<li><p>它会将代码解析为 AST，再按统一规则“打印”成漂亮的代码格式。</p>
</li>
</ul>
<h3 id="3-✅-Babel（JavaScript-编译器）"><a href="#3-✅-Babel（JavaScript-编译器）" class="headerlink" title="3. ✅ Babel（JavaScript 编译器）"></a>3. ✅ Babel（JavaScript 编译器）</h3><ul>
<li><p>把新的 JavaScript 语法（ES6+）转换为兼容旧浏览器的代码。</p>
</li>
<li><p>工作流程是：<strong>代码 → AST → 修改 AST → 重新生成代码</strong>。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">square</span> = x =&gt; x * x;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Babel转换为</span></span><br><span class="line"><span class="keyword">var</span> square = <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个转换背后就是通过对 AST 的修改实现的。</p>
<h3 id="4-✅-自动重构-代码生成"><a href="#4-✅-自动重构-代码生成" class="headerlink" title="4. ✅ 自动重构 &#x2F; 代码生成"></a>4. ✅ 自动重构 &#x2F; 代码生成</h3><ul>
<li><p>比如你可以写一个脚本，遍历 AST，自动把所有的 <code>var</code> 变量声明改为 <code>let</code>。</p>
</li>
<li><p>也可以用 AST 来生成代码片段，比如自动插入日志语句、包裹函数调用等。</p>
</li>
</ul>
<h3 id="5-✅-前端框架构建工具（如-Webpack、Rollup）"><a href="#5-✅-前端框架构建工具（如-Webpack、Rollup）" class="headerlink" title="5. ✅ 前端框架构建工具（如 Webpack、Rollup）"></a>5. ✅ 前端框架构建工具（如 Webpack、Rollup）</h3><ul>
<li><p>在打包过程中分析模块依赖、处理 <code>import/export</code>，这些都涉及 AST 分析。</p>
</li>
<li><p>Tree-shaking（剔除未用代码）也依赖 AST 判断哪些代码被引用了。</p>
</li>
</ul>
<h3 id="6-✅-安全检测"><a href="#6-✅-安全检测" class="headerlink" title="6. ✅ 安全检测"></a>6. ✅ 安全检测</h3><ul>
<li>通过 AST 识别一些危险操作，比如 <code>eval()</code>、跨域访问等。</li>
</ul>
<hr>
<h2 id="✅-四、如何实际使用-AST？"><a href="#✅-四、如何实际使用-AST？" class="headerlink" title="✅ 四、如何实际使用 AST？"></a>✅ 四、如何实际使用 AST？</h2><p>以 JavaScript 为例，常用的库有：</p>
<h3 id="🔧-1-acorn-espree-babel-parser：将代码转成-AST"><a href="#🔧-1-acorn-espree-babel-parser：将代码转成-AST" class="headerlink" title="🔧 1. acorn &#x2F; espree &#x2F; @babel/parser：将代码转成 AST"></a>🔧 1. <code>acorn</code> &#x2F; <code>espree</code> &#x2F; <code>@babel/parser</code>：将代码转成 AST</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> acorn = <span class="built_in">require</span>(<span class="string">&quot;acorn&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ast = acorn.<span class="title function_">parse</span>(<span class="string">&quot;let x = 1 + 2&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(ast, <span class="literal">null</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h3 id="🔧-2-estraverse-babel-traverse：遍历和修改-AST"><a href="#🔧-2-estraverse-babel-traverse：遍历和修改-AST" class="headerlink" title="🔧 2. estraverse &#x2F; babel-traverse：遍历和修改 AST"></a>🔧 2. <code>estraverse</code> &#x2F; <code>babel-traverse</code>：遍历和修改 AST</h3><h3 id="🔧-3-escodegen-babel-generator：将-AST-再生成代码"><a href="#🔧-3-escodegen-babel-generator：将-AST-再生成代码" class="headerlink" title="🔧 3. escodegen &#x2F; @babel/generator：将 AST 再生成代码"></a>🔧 3. <code>escodegen</code> &#x2F; <code>@babel/generator</code>：将 AST 再生成代码</h3><hr>
<h2 id="✅-五、小结"><a href="#✅-五、小结" class="headerlink" title="✅ 五、小结"></a>✅ 五、小结</h2><table>
<thead>
<tr>
<th>术语</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>AST</td>
<td>抽象语法树，代码结构的树形表示</td>
</tr>
<tr>
<td>作用</td>
<td>分析、优化、转换代码</td>
</tr>
<tr>
<td>典型应用</td>
<td>ESLint、Prettier、Babel、Webpack</td>
</tr>
<tr>
<td>常用工具</td>
<td>Babel、Acorn、Esprima、Recast 等</td>
</tr>
</tbody></table>
<hr>
<h2 id="将所有-let-改成-const？"><a href="#将所有-let-改成-const？" class="headerlink" title="将所有 let 改成 const？"></a>将所有 <code>let</code> 改成 <code>const</code>？</h2><p>太好了！我们来写一个<strong>实战例子</strong>：用 JavaScript 代码和 AST 工具库，实现一个功能 —— **把所有的 <code>let</code> 声明改成 <code>const</code>**。</p>
<hr>
<h2 id="✅-目标"><a href="#✅-目标" class="headerlink" title="✅ 目标"></a>✅ 目标</h2><p>输入代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span> + <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>我们希望变成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">2</span> + <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="✅-步骤解析"><a href="#✅-步骤解析" class="headerlink" title="✅ 步骤解析"></a>✅ 步骤解析</h2><p>我们会用三个核心工具库：</p>
<ol>
<li><p><code>@babel/parser</code>：把 JS 源码解析成 AST</p>
</li>
<li><p><code>@babel/traverse</code>：遍历 AST，找到我们要改的节点</p>
</li>
<li><p><code>@babel/generator</code>：把修改后的 AST 再生成 JS 代码</p>
</li>
</ol>
<hr>
<h2 id="✅-示例代码（完整可运行）"><a href="#✅-示例代码（完整可运行）" class="headerlink" title="✅ 示例代码（完整可运行）"></a>✅ 示例代码（完整可运行）</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装依赖：npm install @babel/parser @babel/traverse @babel/generator</span></span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&#x27;@babel/parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&#x27;@babel/traverse&#x27;</span>).<span class="property">default</span>;</span><br><span class="line"><span class="keyword">const</span> generator = <span class="built_in">require</span>(<span class="string">&#x27;@babel/generator&#x27;</span>).<span class="property">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输入代码</span></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">let a = 1;</span></span><br><span class="line"><span class="string">let b = 2 + 3;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 解析代码成 AST</span></span><br><span class="line"><span class="keyword">const</span> ast = parser.<span class="title function_">parse</span>(code, &#123;</span><br><span class="line">  <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&#x27;jsx&#x27;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 遍历 AST，修改 let -&gt; const</span></span><br><span class="line"><span class="title function_">traverse</span>(ast, &#123;</span><br><span class="line">  <span class="title class_">VariableDeclaration</span>(path) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">kind</span> === <span class="string">&#x27;let&#x27;</span>) &#123;</span><br><span class="line">      path.<span class="property">node</span>.<span class="property">kind</span> = <span class="string">&#x27;const&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把修改后的 AST 转换回代码</span></span><br><span class="line"><span class="keyword">const</span> output = <span class="title function_">generator</span>(ast).<span class="property">code</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;✅ 修改后的代码：\n&#x27;</span>, output);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="✅-输出结果"><a href="#✅-输出结果" class="headerlink" title="✅ 输出结果"></a>✅ 输出结果</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">2</span> + <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>完美！</p>
<hr>
<h2 id="✅-延伸（更复杂的修改）"><a href="#✅-延伸（更复杂的修改）" class="headerlink" title="✅ 延伸（更复杂的修改）"></a>✅ 延伸（更复杂的修改）</h2><p>你可以继续用这种方式做更多智能处理，比如：</p>
<ul>
<li><p>替换函数名</p>
</li>
<li><p>给函数自动加上 <code>console.log</code> 日志</p>
</li>
<li><p>自动删除没用的变量</p>
</li>
<li><p>识别危险用法（如 <code>eval()</code>）</p>
</li>
</ul>
<hr>
<h2 id="✅-总结"><a href="#✅-总结" class="headerlink" title="✅ 总结"></a>✅ 总结</h2><table>
<thead>
<tr>
<th>步骤</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>parser</code></td>
<td>源码 ➜ AST</td>
</tr>
<tr>
<td><code>traverse</code></td>
<td>遍历修改 AST 中的节点</td>
</tr>
<tr>
<td><code>generator</code></td>
<td>AST ➜ 新源码</td>
</tr>
</tbody></table>
<hr>
<h2 id="只改一部分-let（不能重新赋值的）为-const”，我也可以带你继续进阶写分析判断逻辑。是否继续？"><a href="#只改一部分-let（不能重新赋值的）为-const”，我也可以带你继续进阶写分析判断逻辑。是否继续？" class="headerlink" title="只改一部分 let（不能重新赋值的）为 const”，我也可以带你继续进阶写分析判断逻辑。是否继续？"></a>只改一部分 let（不能重新赋值的）为 const”，我也可以带你继续进阶写分析判断逻辑。是否继续？</h2><p>很好，我们现在来做一个更“智能”的版本：<br><strong>只有在变量没有被重新赋值（即“不可变”）的情况下，才把 <code>let</code> 改成 <code>const</code>。</strong></p>
<hr>
<h2 id="✅-目标（更智能的转换）"><a href="#✅-目标（更智能的转换）" class="headerlink" title="✅ 目标（更智能的转换）"></a>✅ 目标（更智能的转换）</h2><p>输入代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">b = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">let</span> c = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>期望输出：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;  <span class="comment">// 没被改过，可以变成 const</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;    <span class="comment">// 被重新赋值了，保持 let</span></span><br><span class="line"><span class="keyword">const</span> c = <span class="number">5</span>;  <span class="comment">// 没被改过，可以变成 const</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="✅-思路"><a href="#✅-思路" class="headerlink" title="✅ 思路"></a>✅ 思路</h2><p>我们要判断变量是否被“重新赋值”（reassigned）。为此：</p>
<ol>
<li><p>利用 <code>@babel/traverse</code> 的作用域系统，识别变量的绑定（binding）</p>
</li>
<li><p>检查每个变量的绑定是否被 <code>reassigned</code> 过</p>
</li>
<li><p>如果没有，就把 <code>let</code> 改成 <code>const</code></p>
</li>
</ol>
<hr>
<h2 id="✅-代码实现"><a href="#✅-代码实现" class="headerlink" title="✅ 代码实现"></a>✅ 代码实现</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&#x27;@babel/parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&#x27;@babel/traverse&#x27;</span>).<span class="property">default</span>;</span><br><span class="line"><span class="keyword">const</span> generator = <span class="built_in">require</span>(<span class="string">&#x27;@babel/generator&#x27;</span>).<span class="property">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输入代码</span></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">let a = 1;</span></span><br><span class="line"><span class="string">let b = 2;</span></span><br><span class="line"><span class="string">b = 3;</span></span><br><span class="line"><span class="string">let c = 5;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 解析为 AST</span></span><br><span class="line"><span class="keyword">const</span> ast = parser.<span class="title function_">parse</span>(code, &#123;</span><br><span class="line">  <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 遍历 AST，分析变量使用情况</span></span><br><span class="line"><span class="title function_">traverse</span>(ast, &#123;</span><br><span class="line">  <span class="title class_">VariableDeclaration</span>(path) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">kind</span> === <span class="string">&#x27;let&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> allConst = path.<span class="property">node</span>.<span class="property">declarations</span>.<span class="title function_">every</span>(<span class="function">(<span class="params">decl</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> name = decl.<span class="property">id</span>.<span class="property">name</span>;</span><br><span class="line">        <span class="keyword">const</span> binding = path.<span class="property">scope</span>.<span class="title function_">getBinding</span>(name);</span><br><span class="line">        <span class="keyword">return</span> binding &amp;&amp; !binding.<span class="property">constantViolations</span>.<span class="property">length</span>;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (allConst) &#123;</span><br><span class="line">        path.<span class="property">node</span>.<span class="property">kind</span> = <span class="string">&#x27;const&#x27;</span>; <span class="comment">// 安全转换</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 输出修改后的代码</span></span><br><span class="line"><span class="keyword">const</span> output = <span class="title function_">generator</span>(ast).<span class="property">code</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;✅ 输出代码：\n&#x27;</span>, output);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="✅-输出结果-1"><a href="#✅-输出结果-1" class="headerlink" title="✅ 输出结果"></a>✅ 输出结果</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">b = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> c = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>没问题！我们只把真正没有“被重新赋值”的变量从 <code>let</code> 改成了 <code>const</code>。</p>
<hr>
<h2 id="✅-小知识：constantViolations"><a href="#✅-小知识：constantViolations" class="headerlink" title="✅ 小知识：constantViolations"></a>✅ 小知识：<code>constantViolations</code></h2><p>这是 Babel 的术语，用来表示<strong>某个变量的“常量约束”是否被破坏了</strong>。</p>
<ul>
<li><p>如果你写了 <code>b = 3</code>，就会记录在 <code>constantViolations</code> 中。</p>
</li>
<li><p>所以 <code>binding.constantViolations.length &gt; 0</code>，说明该变量“变动”了。</p>
</li>
</ul>
<hr>
<h2 id="✅-你可以继续拓展的方向"><a href="#✅-你可以继续拓展的方向" class="headerlink" title="✅ 你可以继续拓展的方向"></a>✅ 你可以继续拓展的方向</h2><ul>
<li><p>✅ 替换变量名（变量统一重命名）</p>
</li>
<li><p>✅ 给函数或方法加日志（比如打印参数）</p>
</li>
<li><p>✅ 分析函数是否是纯函数</p>
</li>
<li><p>✅ 自动插入类型注释（TypeScript）</p>
</li>
<li><p>✅ 批量改 API 写法（比如 React 从 <code>componentWillMount</code> 改为 <code>useEffect</code>）</p>
</li>
</ul>
<hr>
<p>✅ <strong>是的，你的理解完全正确！AST 在大规模代码重构中非常有用，而且是很多大型工具和团队的核心技术手段。</strong></p>
<hr>
<h2 id="✅-为什么-AST-对重构特别适合？"><a href="#✅-为什么-AST-对重构特别适合？" class="headerlink" title="✅ 为什么 AST 对重构特别适合？"></a>✅ 为什么 AST 对重构特别适合？</h2><h3 id="1-结构化操作，不靠“文本替换”"><a href="#1-结构化操作，不靠“文本替换”" class="headerlink" title="1. 结构化操作，不靠“文本替换”"></a>1. <strong>结构化操作，不靠“文本替换”</strong></h3><p>传统的字符串搜索 + 替换有很多问题：</p>
<ul>
<li><p>容易误改（比如变量名出现在注释、字符串里）</p>
</li>
<li><p>无法准确处理作用域、类型、导入关系</p>
</li>
</ul>
<p>而 AST 是“<strong>语法层面</strong>”的结构表示，可以精确定位：</p>
<ul>
<li><p>某个变量的定义和使用</p>
</li>
<li><p>某个函数的参数、返回值</p>
</li>
<li><p>某个模块的依赖关系</p>
</li>
</ul>
<p>这就像你在修改“程序逻辑”而不是“文本内容”。</p>
<hr>
<h2 id="✅-实际案例：团队如何用-AST-自动重构"><a href="#✅-实际案例：团队如何用-AST-自动重构" class="headerlink" title="✅ 实际案例：团队如何用 AST 自动重构"></a>✅ 实际案例：团队如何用 AST 自动重构</h2><table>
<thead>
<tr>
<th>场景</th>
<th>重构目标</th>
<th>AST 如何发挥作用</th>
</tr>
</thead>
<tbody><tr>
<td>前端组件升级</td>
<td>把旧组件 API（props）批量换成新版本</td>
<td>精确查找 JSX 中的属性名，替换并保留注释</td>
</tr>
<tr>
<td>函数迁移</td>
<td>老库中的 <code>utils.doX()</code> 改成新库的 <code>newUtils.doX()</code></td>
<td>检查导入语句 + 函数调用位置，自动修改</td>
</tr>
<tr>
<td>模块拆分</td>
<td>拆成多个文件，更新引用路径</td>
<td>找到 <code>import</code> 和 <code>require</code> 路径，统一改路径</td>
</tr>
<tr>
<td>JS ➜ TS</td>
<td>给变量、函数自动加上类型注解</td>
<td>利用 AST 获取上下文，插入合适的类型节点</td>
</tr>
<tr>
<td>console 清理</td>
<td>清除所有 <code>console.log()</code> 但保留 <code>console.error()</code></td>
<td>用 AST 区分调用对象和方法名，精准处理</td>
</tr>
</tbody></table>
<hr>
<h2 id="✅-工具推荐"><a href="#✅-工具推荐" class="headerlink" title="✅ 工具推荐"></a>✅ 工具推荐</h2><table>
<thead>
<tr>
<th>工具名</th>
<th>功能</th>
<th>适合用例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>jscodeshift</strong>（by Facebook）</td>
<td>基于 AST 的“代码变换脚本”工具</td>
<td>批量重构 React &#x2F; JS</td>
</tr>
<tr>
<td><strong>babel + traverse</strong></td>
<td>自定义修改 JS &#x2F; TS 代码的 AST</td>
<td>精细控制，功能强大</td>
</tr>
<tr>
<td><strong>ts-morph</strong>（基于 TypeScript AST）</td>
<td>操作 TypeScript 代码最强工具之一</td>
<td>自动类型补全、重构</td>
</tr>
<tr>
<td><strong>eslint + eslint rules</strong></td>
<td>检查和自动修复代码问题</td>
<td>自定义规则、提示或修复建议</td>
</tr>
<tr>
<td><strong>codemod</strong></td>
<td>多种语言的重构工具集</td>
<td>Python &#x2F; JS 都可用</td>
</tr>
</tbody></table>
<hr>
<h2 id="✅-真实企业场景（简述）"><a href="#✅-真实企业场景（简述）" class="headerlink" title="✅ 真实企业场景（简述）"></a>✅ 真实企业场景（简述）</h2><h3 id="🎯-案例：React-组件库升级"><a href="#🎯-案例：React-组件库升级" class="headerlink" title="🎯 案例：React 组件库升级"></a>🎯 案例：React 组件库升级</h3><blockquote>
<p>某公司准备从旧组件库（比如 antd v3）升级到新组件库（比如 antd v4），需要把所有 <code>&lt;Button type=&quot;primary&quot;&gt;</code> 改为 <code>&lt;Button variant=&quot;solid&quot;&gt;</code></p>
</blockquote>
<p>👨‍💻 人工改？几千处，代价巨大<br>⚙️ 用 AST：</p>
<ul>
<li><p>用 Babel 解析项目所有源码</p>
</li>
<li><p>定位所有 JSX 元素中 <code>Button</code> 的 <code>type=&quot;primary&quot;</code></p>
</li>
<li><p>替换为 <code>variant=&quot;solid&quot;</code>，保留注释、顺序不乱</p>
</li>
<li><p>一键生成重构后代码</p>
</li>
</ul>
<hr>
<h2 id="✅-小结"><a href="#✅-小结" class="headerlink" title="✅ 小结"></a>✅ 小结</h2><blockquote>
<p><strong>AST 是“结构化编程”的核心武器，尤其适合做大批量、精准、可重复的代码重构。</strong></p>
</blockquote>
<h3 id="它可以帮你做到："><a href="#它可以帮你做到：" class="headerlink" title="它可以帮你做到："></a>它可以帮你做到：</h3><ul>
<li><p>自动化</p>
</li>
<li><p>零误伤</p>
</li>
<li><p>安全、可控的代码升级</p>
</li>
</ul>
<hr>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/js-js%E5%8D%95%E7%BA%BF%E7%A8%8B/"
                                   title=""
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis"></span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/html-src-href/"
                                   title=""
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis"></span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Keep Team</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    

    <!-- tablet toc -->
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
